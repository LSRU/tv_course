<!DOCTYPE html>
<html>
<head>
  <title>Data transformation</title>

  <meta charset="utf-8">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <meta name="generator" content="pandoc" />




  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">

  <base target="_blank">

  <script type="text/javascript">
    var SLIDE_CONFIG = {
      // Slide settings
      settings: {
                title: 'Data transformation',
                        subtitle: 'dplyr',
                useBuilds: true,
        usePrettify: true,
        enableSlideAreas: true,
        enableTouch: true,
                        favIcon: 'lecture06_dplyr_files/logo.png',
              },

      // Author information
      presenters: [
            {
        name:  'A. Ginolhac, E. Koncina, R. Krause' ,
        company: '',
        gplus: '',
        twitter: '',
        www: '',
        github: ''
      },
            ]
    };
  </script>

  <style type="text/css">

    b, strong {
      font-weight: bold;
    }

    em {
      font-style: italic;
    }

    slides > slide {
      -webkit-transition: all 0.4s ease-in-out;
      -moz-transition: all 0.4s ease-in-out;
      -o-transition: all 0.4s ease-in-out;
      transition: all 0.4s ease-in-out;
    }

    .auto-fadein {
      -webkit-transition: opacity 0.6s ease-in;
      -webkit-transition-delay: 0.4s;
      -moz-transition: opacity 0.6s ease-in 0.4s;
      -o-transition: opacity 0.6s ease-in 0.4s;
      transition: opacity 0.6s ease-in 0.4s;
      opacity: 0;
    }
  </style>

  <link rel="stylesheet" href="css/tweaks.css" type="text/css" />

  <link href="site_libs/ioslides-13.5.1/fonts/fonts.css" rel="stylesheet" />
  <link href="site_libs/ioslides-13.5.1/theme/css/default.css" rel="stylesheet" />
  <link href="site_libs/ioslides-13.5.1/theme/css/phone.css" rel="stylesheet" />
  <script src="site_libs/ioslides-13.5.1/js/modernizr.custom.45394.js"></script>
  <script src="site_libs/ioslides-13.5.1/js/prettify/prettify.js"></script>
  <script src="site_libs/ioslides-13.5.1/js/prettify/lang-yaml.js"></script>
  <script src="site_libs/ioslides-13.5.1/js/hammer.js"></script>
  <script src="site_libs/ioslides-13.5.1/js/slide-controller.js"></script>
  <script src="site_libs/ioslides-13.5.1/js/slide-deck.js"></script>
  <link href="site_libs/iosp-0.1/css/iosp.css" rel="stylesheet" />
  <script src="site_libs/iosp-0.1/js/lang-r.js"></script>
  <style type="text/css">
  
    .bg-my_colour {
      background-color: #7A67EE;
    }
  
    .box.bg-my_colour {
      border: 2px solid #3D3477;
      color: #fff;
    }
  
    .box.bg-my_colour > h3:first-child {
      background-color: #3D3477;
      color: #fff;
    }
  
    .bg-yellow2 {
      background-color: #FFEC8B;
    }
  
    .box.bg-yellow2 {
      border: 2px solid #EEB422;
      color: #000;
    }
  
    .box.bg-yellow2 > h3:first-child {
      background-color: #EEB422;
      color: #000;
    }
  </style>

</head>

<body style="opacity: 0">

<slides class="layout-widescreen">

  <slide class="title-slide segue nobackground">
        <aside class="gdbar"><img src="lecture06_dplyr_files/logo.png"></aside>
        <!-- The content of this hgroup is replaced programmatically through the slide_config.json. -->
    <hgroup class="auto-fadein">
      <h1 data-config-title><!-- populated from slide_config.json --></h1>
      <h2 data-config-subtitle><!-- populated from slide_config.json --></h2>
      <p data-config-presenter><!-- populated from slide_config.json --></p>
            <p style="margin-top: 6px; margin-left: -2px;">2 May 2017</p>
          </hgroup>
  </slide>

<slide class=''><hgroup><h2>Data transformation </h2><h3> Introduction</h3></hgroup><article  id="data-transformation-introduction" class="smaller ">

<ul>
<li>Transforming data for use with models is where there majority of time in analysis goes</li>
</ul>

<div class = 'row build'><div class = 'box col-8 bg-yellow2  stretch'><h3><code>dplyr</code> in a nutshell</h3>

<ul>
<li><code>dplyr</code> is a tool box for working with data in tibbles or data frames

<ul>
<li>Selection and manipulation of observation, variables and values</li>
<li>Summarizing</li>
<li>Grouping</li>
<li>Joining and intersecting tibbles</li>
</ul></li>
<li>In a workflow typically follows reshaping operations from <code>tidyr</code></li>
</ul>

</div></div></article><div class = "footer"><a href='https://lsru.github.io/tv_course/'>R tidyverse workshop</a></div></slide><slide class=''><hgroup><h2>dplyr </h2><h3> Introduction: <a href='https://www.rstudio.com/resources/cheatsheets/' title=''>Cheat sheets</a></h3></hgroup><article  id="dplyr-introduction-cheat-sheets" class="smaller ">

<div id="unnamed-chunk-1">
<p><img src="img/06_dplyr_cheatsheet.png" width="90%" style="display: block; margin: auto;" /></p></div>

</article><div class = "footer"><a href='https://lsru.github.io/tv_course/'>R tidyverse workshop</a></div></slide><slide class=''><hgroup><h2>dplyr </h2><h3> Introduction: <a href='https://www.rstudio.com/resources/cheatsheets/' title=''>Cheat sheets</a> (cont.)</h3></hgroup><article  id="dplyr-introduction-cheat-sheets-cont." class="smaller ">

<div id="unnamed-chunk-2">
<p><img src="img/06_dplyr_cheatsheet_p2.png" width="90%" style="display: block; margin: auto;" /></p></div>

</article><div class = "footer"><a href='https://lsru.github.io/tv_course/'>R tidyverse workshop</a></div></slide><slide class=''><hgroup><h2>Installation</h2></hgroup><article  id="installation" class="smaller ">

<ul>
<li><code>dplyr</code> is included in the <code>tidyverse</code> package</li>
</ul>

<div id="unnamed-chunk-4" class="chunk shadow">
<pre class = 'prettyprint lang-r'>install.packages(&quot;dplyr&quot;)
# OR
install.packages(&quot;tidyverse&quot;)

library(&quot;dplyr&quot;)</pre></div>

<ul>
<li>For the examples in the lecture, install a big dataset containing all flights departing NYC in 2013:</li>
</ul>

<div id="unnamed-chunk-5" class="chunk shadow">
<pre class = 'prettyprint lang-r'>install.packages(&quot;nycflights13&quot;)
# Load the library
library(&quot;nycflights13&quot;)</pre></div>

<ul>
<li>Or use <code>Rstudio &gt; Tools &gt; Install</code> Packages to install the packages</li>
</ul>

<div id="unnamed-chunk-6" class="chunk shadow">
<pre class = 'prettyprint lang-r'>flights</pre>

<pre ># A tibble: 336,776 × 19
    year month   day dep_time sched_dep_time dep_delay arr_time
   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
1   2013     1     1      517            515         2      830
2   2013     1     1      533            529         4      850
3   2013     1     1      542            540         2      923
4   2013     1     1      544            545        -1     1004
5   2013     1     1      554            600        -6      812
6   2013     1     1      554            558        -4      740
7   2013     1     1      555            600        -5      913
8   2013     1     1      557            600        -3      709
9   2013     1     1      557            600        -3      838
10  2013     1     1      558            600        -2      753
# ... with 336,766 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
#   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
#   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
#   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</pre></div>

</article><div class = "footer"><a href='https://lsru.github.io/tv_course/'>R tidyverse workshop</a></div></slide><slide class=''><hgroup><h2>Inspect data frames / tibbles </h2><h3> glimpse</h3></hgroup><article  id="inspect-data-frames-tibbles-glimpse" class="smaller ">

<p>Use <code>glimpse</code> to show some values and types per column. Environment tab does it too</p>

<div id="unnamed-chunk-7" class="chunk shadow">
<pre class = 'prettyprint lang-r'>glimpse(flights)</pre>

<pre >Observations: 336,776
Variables: 19
$ year           &lt;int&gt; 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013,...
$ month          &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,...
$ day            &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,...
$ dep_time       &lt;int&gt; 517, 533, 542, 544, 554, 554, 555, 557, 557, 55...
$ sched_dep_time &lt;int&gt; 515, 529, 540, 545, 600, 558, 600, 600, 600, 60...
$ dep_delay      &lt;dbl&gt; 2, 4, 2, -1, -6, -4, -5, -3, -3, -2, -2, -2, -2...
$ arr_time       &lt;int&gt; 830, 850, 923, 1004, 812, 740, 913, 709, 838, 7...
$ sched_arr_time &lt;int&gt; 819, 830, 850, 1022, 837, 728, 854, 723, 846, 7...
$ arr_delay      &lt;dbl&gt; 11, 20, 33, -18, -25, 12, 19, -14, -8, 8, -2, -...
$ carrier        &lt;chr&gt; &quot;UA&quot;, &quot;UA&quot;, &quot;AA&quot;, &quot;B6&quot;, &quot;DL&quot;, &quot;UA&quot;, &quot;B6&quot;, &quot;EV&quot;,...
$ flight         &lt;int&gt; 1545, 1714, 1141, 725, 461, 1696, 507, 5708, 79...
$ tailnum        &lt;chr&gt; &quot;N14228&quot;, &quot;N24211&quot;, &quot;N619AA&quot;, &quot;N804JB&quot;, &quot;N668DN...
$ origin         &lt;chr&gt; &quot;EWR&quot;, &quot;LGA&quot;, &quot;JFK&quot;, &quot;JFK&quot;, &quot;LGA&quot;, &quot;EWR&quot;, &quot;EWR&quot;...
$ dest           &lt;chr&gt; &quot;IAH&quot;, &quot;IAH&quot;, &quot;MIA&quot;, &quot;BQN&quot;, &quot;ATL&quot;, &quot;ORD&quot;, &quot;FLL&quot;...
$ air_time       &lt;dbl&gt; 227, 227, 160, 183, 116, 150, 158, 53, 140, 138...
$ distance       &lt;dbl&gt; 1400, 1416, 1089, 1576, 762, 719, 1065, 229, 94...
$ hour           &lt;dbl&gt; 5, 5, 5, 5, 6, 5, 6, 6, 6, 6, 6, 6, 6, 6, 6, 5,...
$ minute         &lt;dbl&gt; 15, 29, 40, 45, 0, 58, 0, 0, 0, 0, 0, 0, 0, 0, ...
$ time_hour      &lt;dttm&gt; 2013-01-01 05:00:00, 2013-01-01 05:00:00, 2013...</pre></div>

</article><div class = "footer"><a href='https://lsru.github.io/tv_course/'>R tidyverse workshop</a></div></slide><slide class=''><hgroup><h2>Pipes in R </h2><h3> magrittr</h3></hgroup><article  id="pipes-in-r-magrittr" class="smaller ">

<div id="unnamed-chunk-8">
<p><img src="img/05_piping.png" width="70%" style="display: block; margin: auto;" /></p></div>

<p>from <a href='https://twitter.com/ParisRaddict/status/781267225420435461' title=''>Romain François</a></p>

</article><div class = "footer"><a href='https://lsru.github.io/tv_course/'>R tidyverse workshop</a></div></slide><slide class=''><hgroup><h2>filter </h2><h3> inspect subsets of data</h3></hgroup><article  id="filter-inspect-subsets-of-data" class="smaller ">

<ul>
<li>How many flights flew to La Guardia, NY in 2013? <em>Expecting none&#8230;</em></li>
</ul>

<div id="unnamed-chunk-9" class="chunk shadow">
<pre class = 'prettyprint lang-r'>flights %&gt;%
  filter(dest == &quot;LGA&quot;)</pre>

<pre ># A tibble: 1 × 19
   year month   day dep_time sched_dep_time dep_delay arr_time
  &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
1  2013     7    27       NA            106        NA       NA
# ... with 12 more variables: sched_arr_time &lt;int&gt;, arr_delay &lt;dbl&gt;,
#   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
#   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;,
#   time_hour &lt;dttm&gt;</pre></div>

</article><div class = "footer"><a href='https://lsru.github.io/tv_course/'>R tidyverse workshop</a></div></slide><slide class=''><hgroup><h2>filter </h2><h3> multiple conditions, AND (<code>&amp;</code>)</h3></hgroup><article  id="filter-multiple-conditions-and" class="smaller ">

<p>How many flights flew to Madison in first week of January?</p>

<div id="unnamed-chunk-10" class="chunk shadow">
<pre class = 'prettyprint lang-r'># Comma separated conditions are combined with &#39;&amp;&#39;
flights %&gt;%
  filter(dest == &quot;MSN&quot;, month == 1, day &lt;= 7)</pre>

<pre ># A tibble: 6 × 19
   year month   day dep_time sched_dep_time dep_delay arr_time
  &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
1  2013     1     1     1353           1357        -4     1549
2  2013     1     2     1422           1357        25     1604
3  2013     1     3     1415           1351        24     1540
4  2013     1     4     1345           1350        -5     1525
5  2013     1     6     1340           1345        -5     1506
6  2013     1     7     1348           1350        -2     1625
# ... with 12 more variables: sched_arr_time &lt;int&gt;, arr_delay &lt;dbl&gt;,
#   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
#   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;,
#   time_hour &lt;dttm&gt;</pre></div>

</article><div class = "footer"><a href='https://lsru.github.io/tv_course/'>R tidyverse workshop</a></div></slide><slide class=''><hgroup><h2>filter </h2><h3> multiple conditions, OR (<code>|</code>)</h3></hgroup><article  id="filter-multiple-conditions-or" class="smaller ">

<div id="unnamed-chunk-11" class="chunk shadow">
<pre class = 'prettyprint lang-r'>flights %&gt;%
  filter(dest == &quot;MSN&quot; | dest == &quot;ORD&quot; | dest == &quot;MDW&quot;)</pre></div>

<p>For more complicated checks, prefer a set operation.<br/>The following 2 are equivalent:</p>

<div id="unnamed-chunk-12" class="chunk shadow">
<pre class = 'prettyprint lang-r'>flights %&gt;%
  filter(is.element(dest, c(&quot;MSN&quot;, &quot;ORD&quot;, &quot;MDW&quot;)))</pre></div>

<div id="unnamed-chunk-13" class="chunk shadow">
<pre class = 'prettyprint lang-r'>flights %&gt;%
  filter(dest %in% c(&quot;MSN&quot;, &quot;ORD&quot;, &quot;MDW&quot;))</pre></div>

</article><div class = "footer"><a href='https://lsru.github.io/tv_course/'>R tidyverse workshop</a></div></slide><slide class=''><hgroup><h2>arrange </h2><h3> sort columns</h3></hgroup><article  id="arrange-sort-columns" class="smaller ">

<div class = 'row build'><div class = 'box col-6 bg-yellow2 '><h3>Perform a nested sorting of all flights in NYC:</h3>

<pre >1. By which airport they departed
2. year
3. month
4. day</pre>

</div></div>

<div id="unnamed-chunk-14" class="chunk shadow">
<pre class = 'prettyprint lang-r'>flights %&gt;%
  arrange(origin, year, month, day)</pre>

<pre ># A tibble: 336,776 × 19
    year month   day dep_time sched_dep_time dep_delay arr_time
   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
1   2013     1     1      517            515         2      830
2   2013     1     1      554            558        -4      740
3   2013     1     1      555            600        -5      913
4   2013     1     1      558            600        -2      923
5   2013     1     1      559            600        -1      854
6   2013     1     1      601            600         1      844
7   2013     1     1      606            610        -4      858
8   2013     1     1      607            607         0      858
9   2013     1     1      608            600         8      807
10  2013     1     1      615            615         0      833
# ... with 336,766 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
#   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
#   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
#   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</pre></div>

</article><div class = "footer"><a href='https://lsru.github.io/tv_course/'>R tidyverse workshop</a></div></slide><slide class=''><hgroup><h2>arrange </h2><h3> <code>desc</code> to reverse sort columns</h3></hgroup><article  id="arrange-desc-to-reverse-sort-columns" class="smaller ">

<p>Find the longest delays for flights to Madison.</p>

<div id="unnamed-chunk-15" class="chunk shadow">
<pre class = 'prettyprint lang-r'>flights %&gt;%
  filter(dest == &quot;MSN&quot;) %&gt;%
  arrange(desc(arr_delay)) %&gt;%
  select(arr_delay, everything()) # way to reorder arr_delay 1st column</pre>

<pre ># A tibble: 572 × 19
   arr_delay  year month   day dep_time sched_dep_time dep_delay arr_time
       &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
1        364  2013     9    12     1841           1350       291     2135
2        337  2013    12     5     2000           1420       340     2132
3        301  2013    10     7     1912           1425       287     2048
4        298  2013     3     8     1907           1405       302     2031
5        293  2013     3    14     1845           1405       280     2026
6        274  2013    11    17       45           1935       310      206
7        274  2013     6    30     1855           1415       280     2013
8        264  2013    10    11     1857           1425       272     2011
9        247  2013     2     6     2242           1825       257       15
10       222  2013    12    31     1819           1505       194     2023
# ... with 562 more rows, and 11 more variables: sched_arr_time &lt;int&gt;,
#   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
#   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;,
#   time_hour &lt;dttm&gt;</pre></div>

</article><div class = "footer"><a href='https://lsru.github.io/tv_course/'>R tidyverse workshop</a></div></slide><slide class=''><hgroup><h2>Your turn</h2></hgroup><article  id="your-turn" class="smaller build">

<ul>
<li>Find the most delayed (in minutes) flight in 2013</li>
</ul>

<div id="unnamed-chunk-16" class="chunk shadow">
<pre class = 'prettyprint lang-r'>flights %&gt;%
  arrange(desc(arr_delay)) %&gt;%
  select(arr_delay, everything()) %&gt;% head(3)</pre>

<pre ># A tibble: 3 × 19
  arr_delay  year month   day dep_time sched_dep_time dep_delay arr_time
      &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
1      1272  2013     1     9      641            900      1301     1242
2      1127  2013     6    15     1432           1935      1137     1607
3      1109  2013     1    10     1121           1635      1126     1239
# ... with 11 more variables: sched_arr_time &lt;int&gt;, carrier &lt;chr&gt;,
#   flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;,
#   distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</pre></div>

<div id="unnamed-chunk-17" class="chunk shadow">
<pre class = 'prettyprint lang-r'>1272 / 60</pre>

<pre >[1] 21.2</pre></div>

</article><div class = "footer"><a href='https://lsru.github.io/tv_course/'>R tidyverse workshop</a></div></slide><slide class=''><hgroup><h2>select </h2><h3> selecting specific columns</h3></hgroup><article  id="select-selecting-specific-columns" class="smaller ">

<div id="unnamed-chunk-18" class="chunk shadow">
<pre class = 'prettyprint lang-r'>flights %&gt;%
  select(origin, year, month, day)</pre>

<pre ># A tibble: 336,776 × 4
   origin  year month   day
    &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;
1     EWR  2013     1     1
2     LGA  2013     1     1
3     JFK  2013     1     1
4     JFK  2013     1     1
5     LGA  2013     1     1
6     EWR  2013     1     1
7     EWR  2013     1     1
8     LGA  2013     1     1
9     JFK  2013     1     1
10    LGA  2013     1     1
# ... with 336,766 more rows</pre></div>

</article><div class = "footer"><a href='https://lsru.github.io/tv_course/'>R tidyverse workshop</a></div></slide><slide class=''><hgroup><h2>select </h2><h3> helper functions</h3></hgroup><article  id="select-helper-functions" class="smaller ">

<p><code>select</code> has many helper functions. See <code>?select</code> or have a look at the cheatsheet.</p>

<div id="unnamed-chunk-19" class="chunk shadow">
<pre class = 'prettyprint lang-r'>flights %&gt;%
  select(origin, year:day, starts_with(&quot;dep&quot;))</pre>

<pre ># A tibble: 336,776 × 6
   origin  year month   day dep_time dep_delay
    &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;     &lt;dbl&gt;
1     EWR  2013     1     1      517         2
2     LGA  2013     1     1      533         4
3     JFK  2013     1     1      542         2
4     JFK  2013     1     1      544        -1
5     LGA  2013     1     1      554        -6
6     EWR  2013     1     1      554        -4
7     EWR  2013     1     1      555        -5
8     LGA  2013     1     1      557        -3
9     JFK  2013     1     1      557        -3
10    LGA  2013     1     1      558        -2
# ... with 336,766 more rows</pre></div>

</article><div class = "footer"><a href='https://lsru.github.io/tv_course/'>R tidyverse workshop</a></div></slide><slide class=''><hgroup><h2>negative selecting</h2></hgroup><article  id="negative-selecting" class="smaller ">

<p>We can drop columns by &quot;negating&quot; their names. Since helpers give us column names, we can negate them too.</p>

<div id="unnamed-chunk-20" class="chunk shadow">
<pre class = 'prettyprint lang-r'>flights %&gt;%
  select(-dest, -starts_with(&quot;arr&quot;),
         -ends_with(&quot;time&quot;))</pre>

<pre ># A tibble: 336,776 × 12
    year month   day dep_delay carrier flight tailnum origin distance
   &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;dbl&gt;   &lt;chr&gt;  &lt;int&gt;   &lt;chr&gt;  &lt;chr&gt;    &lt;dbl&gt;
1   2013     1     1         2      UA   1545  N14228    EWR     1400
2   2013     1     1         4      UA   1714  N24211    LGA     1416
3   2013     1     1         2      AA   1141  N619AA    JFK     1089
4   2013     1     1        -1      B6    725  N804JB    JFK     1576
5   2013     1     1        -6      DL    461  N668DN    LGA      762
6   2013     1     1        -4      UA   1696  N39463    EWR      719
7   2013     1     1        -5      B6    507  N516JB    EWR     1065
8   2013     1     1        -3      EV   5708  N829AS    LGA      229
9   2013     1     1        -3      B6     79  N593JB    JFK      944
10  2013     1     1        -2      AA    301  N3ALAA    LGA      733
# ... with 336,766 more rows, and 3 more variables: hour &lt;dbl&gt;,
#   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</pre></div>

</article><div class = "footer"><a href='https://lsru.github.io/tv_course/'>R tidyverse workshop</a></div></slide><slide class=''><hgroup><h2>Recap: Verbs for inspecting data</h2></hgroup><article  id="recap-verbs-for-inspecting-data" class="smaller ">

<ul>
<li><code>as_tibble</code> (<code>dplyr::as_data_frame</code>) to convert to a tibble (different from <code>as.data.frame</code> in <em>R</em> base)</li>
<li><code>glimpse</code> - some of each column</li>
<li><code>filter</code> - subsetting</li>
<li><code>arrange</code> - sorting (<code>desc</code> to reverse the sort)</li>
<li><code>select</code> - picking (and omiting) columns</li>
</ul>

</article><div class = "footer"><a href='https://lsru.github.io/tv_course/'>R tidyverse workshop</a></div></slide><slide class=''><hgroup><h2>rename </h2><h3> renaming columns</h3></hgroup><article  id="rename-renaming-columns" class="smaller ">

<ul>
<li>Rename columns with <code>rename(new_name = old_name)</code>.

<ul>
<li>To keep the order correct, read/remember the renaming <code>=</code> as &quot;was&quot;.</li>
</ul></li>
</ul>

<div id="unnamed-chunk-21" class="chunk shadow">
<pre class = 'prettyprint lang-r'>flights %&gt;%
  rename(y = year, m = month, d = day)</pre>

<pre ># A tibble: 336,776 × 19
       y     m     d dep_time sched_dep_time dep_delay arr_time
   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
1   2013     1     1      517            515         2      830
2   2013     1     1      533            529         4      850
3   2013     1     1      542            540         2      923
4   2013     1     1      544            545        -1     1004
5   2013     1     1      554            600        -6      812
6   2013     1     1      554            558        -4      740
7   2013     1     1      555            600        -5      913
8   2013     1     1      557            600        -3      709
9   2013     1     1      557            600        -3      838
10  2013     1     1      558            600        -2      753
# ... with 336,766 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
#   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
#   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
#   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</pre></div>

</article><div class = "footer"><a href='https://lsru.github.io/tv_course/'>R tidyverse workshop</a></div></slide><slide class=''><hgroup><h2>mutate </h2><h3> add or replace columns</h3></hgroup><article  id="mutate-add-or-replace-columns" class="smaller build">

<ul>
<li>How much departure delay did the flight make up for in the air?<br/></li>
<li>Note that new variables can be used right away</li>
</ul>

<div id="unnamed-chunk-22" class="chunk shadow">
<pre class = 'prettyprint lang-r'>flights %&gt;%
  mutate(
    gain = arr_delay - dep_delay,
    speed = (distance / air_time) * 60,
    gain_per_hour = gain / (air_time / 60)) %&gt;%
  select(gain:gain_per_hour)</pre>

<pre ># A tibble: 336,776 × 3
    gain    speed gain_per_hour
   &lt;dbl&gt;    &lt;dbl&gt;         &lt;dbl&gt;
1      9 370.0441      2.378855
2     16 374.2731      4.229075
3     31 408.3750     11.625000
4    -17 516.7213     -5.573770
5    -19 394.1379     -9.827586
6     16 287.6000      6.400000
7     24 404.4304      9.113924
8    -11 259.2453    -12.452830
9     -5 404.5714     -2.142857
10    10 318.6957      4.347826
# ... with 336,766 more rows</pre></div>

</article><div class = "footer"><a href='https://lsru.github.io/tv_course/'>R tidyverse workshop</a></div></slide><slide class=''><hgroup><h2>Could the gain be explained by speed? </h2><h3> random subsampling</h3></hgroup><article  id="could-the-gain-be-explained-by-speed-random-subsampling" class="smaller ">

<div id="unnamed-chunk-23" class="chunk shadow">
<pre class = 'prettyprint lang-r'>flights %&gt;%
  mutate(gain = arr_delay - dep_delay,
    speed = (distance / air_time) * 60) %&gt;%
  sample_n(10000) %&gt;% # subsample 1e5 rows randomly
  ggplot(aes(x = gain, y = speed)) +
  geom_point(alpha = 0.4)</pre>

<p><img src="lecture06_dplyr_files/figure-html/unnamed-chunk-23-1.png" style="display: block; margin: auto;" /></p></div>

</article><div class = "footer"><a href='https://lsru.github.io/tv_course/'>R tidyverse workshop</a></div></slide><slide class=''><hgroup><h2>Binning to solve overplotting </h2><h3> <code>geom_hex()</code> for hexagons</h3></hgroup><article  id="binning-to-solve-overplotting-geom_hex-for-hexagons" class="smaller ">

<div id="unnamed-chunk-24" class="chunk shadow">
<pre class = 'prettyprint lang-r'>flights %&gt;%
  mutate(gain = arr_delay - dep_delay,
    speed = (distance / air_time) * 60) %&gt;%
  ggplot(aes(x = gain, y = speed)) +
  geom_hex(bins = 80) + # play with bins to ajust the granulometry
  viridis::scale_fill_viridis() + theme_classic()</pre>

<pre >Loading required package: methods</pre>

<p><img src="lecture06_dplyr_files/figure-html/unnamed-chunk-24-1.png" style="display: block; margin: auto;" /></p></div>

</article><div class = "footer"><a href='https://lsru.github.io/tv_course/'>R tidyverse workshop</a></div></slide><slide class=''><hgroup><h2>Binning to solve overplotting </h2><h3> <code>geom_bin2d()</code> for squares</h3></hgroup><article  id="binning-to-solve-overplotting-geom_bin2d-for-squares" class="smaller ">

<div id="unnamed-chunk-25" class="chunk shadow">
<pre class = 'prettyprint lang-r'>flights %&gt;%
  mutate(gain = arr_delay - dep_delay,
    speed = (distance / air_time) * 60) %&gt;%
  ggplot(aes(x = gain, y = speed)) +
  geom_bin2d(bins = 80) + # play with bins to ajust the granulometry
  viridis::scale_fill_viridis() + theme_classic()</pre>

<p><img src="lecture06_dplyr_files/figure-html/unnamed-chunk-25-1.png" style="display: block; margin: auto;" /></p></div>

</article><div class = "footer"><a href='https://lsru.github.io/tv_course/'>R tidyverse workshop</a></div></slide><slide class=''><hgroup><h2>Grouping </h2><h3> <code>group_by()</code></h3></hgroup><article  id="grouping-group_by" class="smaller ">

<ul>
<li>Not a summarising transformation but frequently used in conjunction</li>
<li>Grouping by more than one or more variables</li>
<li>Use <code>ungroup()</code></li>
</ul>

</article><div class = "footer"><a href='https://lsru.github.io/tv_course/'>R tidyverse workshop</a></div></slide><slide class=''><hgroup><h2>group_by </h2><h3> Grouping</h3></hgroup><article  id="group_by-grouping" class="smaller ">

<ul>
<li>Let&#39;s compute the average delay per month of flights to Madison.</li>
</ul>

<div id="unnamed-chunk-26" class="chunk shadow">
<pre class = 'prettyprint lang-r'>flights %&gt;%
  filter(dest == &quot;MSN&quot;) %&gt;%
  group_by(month) %&gt;%
  #Some values are missing, thus tell `mean` to remove them from the calculation.
  summarise(mean_dep_delay = mean(dep_delay, na.rm = TRUE))</pre>

<pre ># A tibble: 12 × 2
   month mean_dep_delay
   &lt;int&gt;          &lt;dbl&gt;
1      1       18.07692
2      2       20.11111
3      3       41.87097
4      4       29.40741
5      5       21.54839
6      6       29.83333
7      7       11.13333
8      8       19.06667
9      9       15.97183
10    10       19.26190
11    11       15.96250
12    12       42.68831</pre></div>

</article><div class = "footer"><a href='https://lsru.github.io/tv_course/'>R tidyverse workshop</a></div></slide><slide class=''><hgroup><h2>group_by </h2><h3> Grouping</h3></hgroup><article  id="group_by-grouping-1" class="smaller ">

<ul>
<li>Work per day</li>
<li>note the tibble info about the 365 groupings</li>
</ul>

<div id="unnamed-chunk-27" class="chunk shadow">
<pre class = 'prettyprint lang-r'>by_day &lt;- flights %&gt;%
  group_by(year, month, day)
by_day</pre>

<pre >Source: local data frame [336,776 x 19]
Groups: year, month, day [365]

    year month   day dep_time sched_dep_time dep_delay arr_time
   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
1   2013     1     1      517            515         2      830
2   2013     1     1      533            529         4      850
3   2013     1     1      542            540         2      923
4   2013     1     1      544            545        -1     1004
5   2013     1     1      554            600        -6      812
6   2013     1     1      554            558        -4      740
7   2013     1     1      555            600        -5      913
8   2013     1     1      557            600        -3      709
9   2013     1     1      557            600        -3      838
10  2013     1     1      558            600        -2      753
# ... with 336,766 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
#   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
#   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
#   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</pre></div>

<p>Note that one level (right most) is removed from grouping.</p>

</article><div class = "footer"><a href='https://lsru.github.io/tv_course/'>R tidyverse workshop</a></div></slide><slide class=''><hgroup><h2>summarise</h2></hgroup><article  id="summarise" class="smaller ">

<ul>
<li>Now we use <code>summarise</code> to compute (several) aggregated values within each group (per day).</li>
<li><code>summarise</code> returns one row per group.</li>
</ul>

<div id="unnamed-chunk-28" class="chunk shadow">
<pre class = 'prettyprint lang-r'>by_day %&gt;%
  summarise(
    flights = n(), # dplyr specific function
    avg_delay = mean(dep_delay, na.rm = TRUE),
    n_planes = n_distinct(tailnum)) # dplyr specific function</pre>

<pre >Source: local data frame [365 x 6]
Groups: year, month [?]

    year month   day flights avg_delay n_planes
   &lt;int&gt; &lt;int&gt; &lt;int&gt;   &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
1   2013     1     1     842 11.548926      649
2   2013     1     2     943 13.858824      712
3   2013     1     3     914 10.987832      689
4   2013     1     4     915  8.951595      689
5   2013     1     5     720  5.732218      578
6   2013     1     6     832  7.148014      640
7   2013     1     7     933  5.417204      682
8   2013     1     8     899  2.553073      667
9   2013     1     9     902  2.276477      666
10  2013     1    10     932  2.844995      689
# ... with 355 more rows</pre></div>

</article><div class = "footer"><a href='https://lsru.github.io/tv_course/'>R tidyverse workshop</a></div></slide><slide class=''><hgroup><h2>Exercise</h2></hgroup><article  id="exercise" class="smaller build exercise">

<ul>
<li><p>In average, how many flights is a single plane doing per day?</p></li>
<li><p>Calculate the average delay per day.</p></li>
<li><p>Which day should be avoided?</p></li>
</ul>

</article><div class = "footer"><a href='https://lsru.github.io/tv_course/'>R tidyverse workshop</a></div></slide><slide class=''><hgroup><h2>Solution </h2><h3> 1. single plane flights per day</h3></hgroup><article  id="solution-1.-single-plane-flights-per-day" class="smaller ">

<div id="unnamed-chunk-29" class="chunk shadow">
<pre class = 'prettyprint lang-r'>by_day %&gt;%
  summarise(flights = n(),
            avg_delay = mean(dep_delay, na.rm = TRUE),
            n_planes = n_distinct(tailnum)) %&gt;%
  mutate(avg_flights = flights / n_planes)</pre>

<pre >Source: local data frame [365 x 7]
Groups: year, month [12]

    year month   day flights avg_delay n_planes avg_flights
   &lt;int&gt; &lt;int&gt; &lt;int&gt;   &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;       &lt;dbl&gt;
1   2013     1     1     842 11.548926      649    1.297381
2   2013     1     2     943 13.858824      712    1.324438
3   2013     1     3     914 10.987832      689    1.326560
4   2013     1     4     915  8.951595      689    1.328012
5   2013     1     5     720  5.732218      578    1.245675
6   2013     1     6     832  7.148014      640    1.300000
7   2013     1     7     933  5.417204      682    1.368035
8   2013     1     8     899  2.553073      667    1.347826
9   2013     1     9     902  2.276477      666    1.354354
10  2013     1    10     932  2.844995      689    1.352685
# ... with 355 more rows</pre></div>

</article><div class = "footer"><a href='https://lsru.github.io/tv_course/'>R tidyverse workshop</a></div></slide><slide class=''><hgroup><h2>Solution </h2><h3> 2. distribution of single plane flights per day</h3></hgroup><article  id="solution-2.-distribution-of-single-plane-flights-per-day" class="smaller ">

<div id="unnamed-chunk-30" class="chunk shadow">
<pre class = 'prettyprint lang-r'>by_day %&gt;%
  summarise(flights = n(),
            avg_delay = mean(dep_delay, na.rm = TRUE),
            n_planes = n_distinct(tailnum)) %&gt;%
  mutate(avg_flights = flights / n_planes)</pre>

<pre >Source: local data frame [365 x 7]
Groups: year, month [12]

    year month   day flights avg_delay n_planes avg_flights
   &lt;int&gt; &lt;int&gt; &lt;int&gt;   &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;       &lt;dbl&gt;
1   2013     1     1     842 11.548926      649    1.297381
2   2013     1     2     943 13.858824      712    1.324438
3   2013     1     3     914 10.987832      689    1.326560
4   2013     1     4     915  8.951595      689    1.328012
5   2013     1     5     720  5.732218      578    1.245675
6   2013     1     6     832  7.148014      640    1.300000
7   2013     1     7     933  5.417204      682    1.368035
8   2013     1     8     899  2.553073      667    1.347826
9   2013     1     9     902  2.276477      666    1.354354
10  2013     1    10     932  2.844995      689    1.352685
# ... with 355 more rows</pre></div>

</article><div class = "footer"><a href='https://lsru.github.io/tv_course/'>R tidyverse workshop</a></div></slide><slide class=''><hgroup><h2>Solution </h2><h3> 3. average delay per day</h3></hgroup><article  id="solution-3.-average-delay-per-day" class="smaller ">

<div id="unnamed-chunk-31" class="chunk shadow">
<pre class = 'prettyprint lang-r'>by_day %&gt;%
  summarise(avg_delay = mean(dep_delay, na.rm = TRUE)) %&gt;%
  unite(date, year, month, day, sep = &quot;-&quot;) %&gt;%
  mutate(date = as.Date(date)) %&gt;%
  ggplot() + 
  geom_bar(aes(x = date, y = avg_delay), stat = &quot;identity&quot;)</pre>

<p><img src="lecture06_dplyr_files/figure-html/unnamed-chunk-31-1.png" style="display: block; margin: auto;" /></p></div>

</article><div class = "footer"><a href='https://lsru.github.io/tv_course/'>R tidyverse workshop</a></div></slide><slide class=''><hgroup><h2>Solution </h2><h3> 4. day to avoid</h3></hgroup><article  id="solution-4.-day-to-avoid" class="smaller ">

<div id="unnamed-chunk-32" class="chunk shadow">
<pre class = 'prettyprint lang-r'>by_day %&gt;%
  summarise(avg_delay = mean(dep_delay, na.rm = TRUE)) %&gt;%
  arrange(desc(avg_delay))</pre>

<pre >Source: local data frame [365 x 4]
Groups: year, month [12]

    year month   day avg_delay
   &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;dbl&gt;
1   2013     3     8  83.53692
2   2013     7     1  56.23383
3   2013     9     2  53.02955
4   2013     7    10  52.86070
5   2013    12     5  52.32799
6   2013     5    23  51.14472
7   2013     9    12  49.95875
8   2013     6    28  48.82778
9   2013     6    24  47.15742
10  2013     7    22  46.66705
# ... with 355 more rows</pre></div>

</article><div class = "footer"><a href='https://lsru.github.io/tv_course/'>R tidyverse workshop</a></div></slide><slide class=''><hgroup><h2>Exercise</h2></hgroup><article  id="exercise-1" class="smaller exercise">

<ul>
<li>Find the destinations with the highest average arrival delay?</li>
<li>discard flights with missing data as arrival delay</li>
<li>count the number of flights per destination</li>
<li>discard results with less than 10 flights, mean not meaningful</li>
</ul>

</article><div class = "footer"><a href='https://lsru.github.io/tv_course/'>R tidyverse workshop</a></div></slide><slide class=''><hgroup><h2>Solution </h2><h3> destinations with highest average arrival delay</h3></hgroup><article  id="solution-destinations-with-highest-average-arrival-delay" class="smaller ">

<div id="unnamed-chunk-33" class="chunk shadow">
<pre class = 'prettyprint lang-r'>flights %&gt;%
  filter(!is.na(arr_delay)) %&gt;%
  group_by(dest) %&gt;%
  summarise(mean = mean(arr_delay),
            n = n()) %&gt;%
  filter(n &gt; 10) %&gt;%
  arrange(desc(mean))</pre>

<pre ># A tibble: 101 × 3
    dest     mean     n
   &lt;chr&gt;    &lt;dbl&gt; &lt;int&gt;
1    CAE 41.76415   106
2    TUL 33.65986   294
3    OKC 30.61905   315
4    JAC 28.09524    21
5    TYS 24.06920   578
6    MSN 20.19604   556
7    RIC 20.11125  2346
8    CAK 19.69834   842
9    DSM 19.00574   523
10   GRR 18.18956   728
# ... with 91 more rows</pre></div>

</article><div class = "footer"><a href='https://lsru.github.io/tv_course/'>R tidyverse workshop</a></div></slide><slide class=''><hgroup><h2>Is there a spatial pattern for those delays?</h2></hgroup><article  id="is-there-a-spatial-pattern-for-those-delays" class="smaller ">

<ul>
<li>First, get the GPS coordinates of airports using the <code>airports</code> data frame</li>
</ul>

<div id="unnamed-chunk-34" class="chunk shadow">
<pre class = 'prettyprint lang-r'>airports</pre>

<pre ># A tibble: 1,458 × 8
     faa                           name      lat        lon   alt    tz
   &lt;chr&gt;                          &lt;chr&gt;    &lt;dbl&gt;      &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt;
1    04G              Lansdowne Airport 41.13047  -80.61958  1044    -5
2    06A  Moton Field Municipal Airport 32.46057  -85.68003   264    -6
3    06C            Schaumburg Regional 41.98934  -88.10124   801    -6
4    06N                Randall Airport 41.43191  -74.39156   523    -5
5    09J          Jekyll Island Airport 31.07447  -81.42778    11    -5
6    0A9 Elizabethton Municipal Airport 36.37122  -82.17342  1593    -5
7    0G6        Williams County Airport 41.46731  -84.50678   730    -5
8    0G7  Finger Lakes Regional Airport 42.88356  -76.78123   492    -5
9    0P2   Shoestring Aviation Airfield 39.79482  -76.64719  1000    -5
10   0S9          Jefferson County Intl 48.05381 -122.81064   108    -8
# ... with 1,448 more rows, and 2 more variables: dst &lt;chr&gt;, tzone &lt;chr&gt;</pre></div>

</article><div class = "footer"><a href='https://lsru.github.io/tv_course/'>R tidyverse workshop</a></div></slide><slide class=''><hgroup><h2>Join two data frames</h2></hgroup><article  id="join-two-data-frames" class="smaller ">

<div id="unnamed-chunk-35" class="chunk shadow">
<pre class = 'prettyprint lang-r'>delays &lt;- flights %&gt;%
  filter(!is.na(arr_delay)) %&gt;%
  group_by(dest) %&gt;%
  summarise(mean = mean(arr_delay),
            n = n()) %&gt;%
  filter(n &gt; 10) %&gt;%
  arrange(desc(mean)) %&gt;%
  inner_join(airports, by = c(&quot;dest&quot; = &quot;faa&quot;)) # provide the equivalence since columns have a different name</pre></div>

<p>We could have used <strong>left_join</strong> but 4 rows with a 3-letters acronym have no correspondance in the <code>airports</code> data frame. <strong>inner_join</strong> narrows down the lines that are present in both data frames.</p>

</article><div class = "footer"><a href='https://lsru.github.io/tv_course/'>R tidyverse workshop</a></div></slide><slide class=''><hgroup><h2>Join types</h2></hgroup><article  id="join-types" class="smaller ">

<div id="unnamed-chunk-36">
<p><img src="http://www.dofactory.com/Images/sql-joins.png" style="display: block; margin: auto;" /></p></div>

<p>Of note: <strong>anti_join</strong> can select rows which identifiers are <strong>absent</strong> in the second data frame.</p>

</article><div class = "footer"><a href='https://lsru.github.io/tv_course/'>R tidyverse workshop</a></div></slide><slide class=''><hgroup><h2>Join as data frames </h2><h3> <strong>mutating</strong> joins</h3></hgroup><article  id="join-as-data-frames-mutating-joins" class="smaller ">

<div id="unnamed-chunk-37">
<p><img src="img/05_joins.png" width="100%" style="display: block; margin: auto;" /></p></div>

<p>credit: <a href='http://r4ds.had.co.nz/relational-data.html' title=''>Hadley Wickham, R for data science</a></p>

</article><div class = "footer"><a href='https://lsru.github.io/tv_course/'>R tidyverse workshop</a></div></slide><slide class=''><hgroup><h2>Join as data frames </h2><h3> <strong>filtering</strong> joins</h3></hgroup><article  id="join-as-data-frames-filtering-joins" class="smaller ">

<div id="unnamed-chunk-38">
<p><img src="img/05_filtering-joins.png" width="100%" style="display: block; margin: auto;" /></p></div>

<p>credit: <a href='http://r4ds.had.co.nz/relational-data.html' title=''>Hadley Wickham, R for data science</a></p>

</article><div class = "footer"><a href='https://lsru.github.io/tv_course/'>R tidyverse workshop</a></div></slide><slide class=''><hgroup><h2>Gradient using viridis scales</h2></hgroup><article  id="gradient-using-viridis-scales" class="smaller ">

<div id="unnamed-chunk-39" class="chunk shadow">
<pre class = 'prettyprint lang-r'>install.packages(&quot;maps&quot;)
library(&quot;maps&quot;)</pre></div>

<p><code>viridis</code> <a href='https://cran.r-project.org/web/packages/viridis/vignettes/intro-to-viridis.html' title=''>vignette</a></p>

<div id="unnamed-chunk-40">
<p><img src="img/05_viridis.png" width="70%" style="display: block; margin: auto;" /></p></div>

</article><div class = "footer"><a href='https://lsru.github.io/tv_course/'>R tidyverse workshop</a></div></slide><slide class=''><hgroup><h2>plot on a map</h2></hgroup><article  id="plot-on-a-map" class="smaller ">

<div id="unnamed-chunk-41" class="chunk shadow">
<pre class = 'prettyprint lang-r'>library(&quot;ggplot2&quot;)
library(&quot;maps&quot;) # US map
ggplot(delays) +
  geom_point(aes(x = lon, y = lat, colour = mean), size = 3, alpha = 0.8) +
  viridis::scale_color_viridis() +
  borders(&quot;state&quot;)</pre>

<p><img src="lecture06_dplyr_files/figure-html/unnamed-chunk-41-1.png" style="display: block; margin: auto;" /></p></div>

</article><div class = "footer"><a href='https://lsru.github.io/tv_course/'>R tidyverse workshop</a></div></slide><slide class=''><hgroup><h2>plot on a map, with text</h2></hgroup><article  id="plot-on-a-map-with-text" class="smaller ">

<div id="unnamed-chunk-42" class="chunk shadow">
<pre class = 'prettyprint lang-r'>library(&quot;ggrepel&quot;)
filter(delays, lon &gt; -140) %&gt;% # remove Honolulu
  ggplot() + geom_point(aes(x = lon, y = lat, colour = mean), size = 3, alpha = 0.8) +
  geom_text_repel(aes(x = lon, y = lat, label = name), size = 2.5) +
  viridis::scale_color_viridis() +
  theme_classic() +
  borders(&quot;state&quot;)</pre>

<p><img src="lecture06_dplyr_files/figure-html/unnamed-chunk-42-1.png" style="display: block; margin: auto;" /></p></div>

</article><div class = "footer"><a href='https://lsru.github.io/tv_course/'>R tidyverse workshop</a></div></slide><slide class=''><hgroup><h2>plot on a map, with conditional text</h2></hgroup><article  id="plot-on-a-map-with-conditional-text" class="smaller ">

<!-- How about the call to a function in data? -->

<div id="geom_label_conditional" class="chunk shadow">
<pre class = 'prettyprint lang-r'>filter(delays, lon &gt; -140) %&gt;% # remove Honolulu
  ggplot() +
  geom_point(aes(x = lon, y = lat, colour = mean),
                      size = 3, alpha = 0.8) +
  viridis::scale_color_viridis() +
  borders(&quot;state&quot;) +
  geom_label_repel(data = delays %&gt;% filter(mean &gt; 20),
            aes(x = lon, y = lat + 1, label = name), fill = &quot;brown&quot;, colour = &quot;white&quot;, size = 3) +
  theme_classic()</pre>

<p><img src="lecture06_dplyr_files/figure-html/geom_label_conditional-1.png" style="display: block; margin: auto;" /></p></div>

</article><div class = "footer"><a href='https://lsru.github.io/tv_course/'>R tidyverse workshop</a></div></slide><slide class=''><hgroup><h2>subset data inside ggplot pipelines</h2></hgroup><article  id="subset-data-inside-ggplot-pipelines" class="smaller ">

<div id="subset_ggplot" class="chunk shadow">
<pre class = 'prettyprint lang-r'>subset_mean &lt;- function(df) {
  filter(df, mean &gt; 20)
}

filter(delays, lon &gt; -140) %&gt;% # remove Honolulu
  ggplot() +
  geom_point(aes(x = lon, y = lat, colour = mean),
                      size = 3, alpha = 0.8) +
  viridis::scale_color_viridis() +
  borders(&quot;state&quot;) +
  geom_label_repel(data = subset_mean,
            aes(x = lon, y = lat + 1, label = name), fill = &quot;brown&quot;, colour = &quot;white&quot;, size = 3) +
  theme_classic()</pre>

<p><img src="lecture06_dplyr_files/figure-html/subset_ggplot-1.png" style="display: block; margin: auto;" /></p></div>

</article><div class = "footer"><a href='https://lsru.github.io/tv_course/'>R tidyverse workshop</a></div></slide><slide class=''><hgroup><h2>tally / count</h2></hgroup><article  id="tally-count" class="smaller ">

<p><code>tally</code> is a shortcut to counting the number of items per group.</p>

<div id="unnamed-chunk-43" class="chunk shadow">
<pre class = 'prettyprint lang-r'>flights %&gt;%
  group_by(dest, month) %&gt;%
  tally() %&gt;% head(3) # could sum up with multiple tally calls</pre>

<pre >Source: local data frame [3 x 3]
Groups: dest [1]

   dest month     n
  &lt;chr&gt; &lt;int&gt; &lt;int&gt;
1   ABQ     4     9
2   ABQ     5    31
3   ABQ     6    30</pre></div>

<p><code>count</code> does the grouping for you</p>

<div id="unnamed-chunk-44" class="chunk shadow">
<pre class = 'prettyprint lang-r'>flights %&gt;%
  count(dest, month) %&gt;% head(3)</pre>

<pre >Source: local data frame [3 x 3]
Groups: dest [1]

   dest month     n
  &lt;chr&gt; &lt;int&gt; &lt;int&gt;
1   ABQ     4     9
2   ABQ     5    31
3   ABQ     6    30</pre></div>

</article><div class = "footer"><a href='https://lsru.github.io/tv_course/'>R tidyverse workshop</a></div></slide><slide class=''><hgroup><h2>That covers 80% of dplyr</h2></hgroup><article  id="that-covers-80-of-dplyr" class="smaller ">

<ul>
<li>select</li>
<li>filter</li>
<li>arrange</li>
<li>glimpse</li>
<li>rename</li>
<li>mutate</li>
<li>group_by, ungroup</li>
<li>summarise</li>
</ul>

</article><div class = "footer"><a href='https://lsru.github.io/tv_course/'>R tidyverse workshop</a></div></slide><slide class=''><hgroup><h2>Other 20%</h2></hgroup><article  id="other-20" class="smaller ">

<ul>
<li>assembly: <code>bind_rows</code>, <code>bind_cols</code></li>
<li>windows function, <code>min_rank</code>, <code>dense_rank</code>, <code>cumsum</code>. See <a href='https://cran.r-project.org/web/packages/dplyr/vignettes/window-functions.html' title=''>vignette</a></li>
<li>column-wise operations: <code>mutate_each</code>, <code>transmute</code>, <code>summarise_each</code></li>
<li>column-wise conditional operations: <code>mutate_at</code>, <code>mutate_if</code>, <code>summarise_at</code>, <code>summarise_if</code></li>
<li><code>do</code>: arbitrary code on each chunk. To be replaced by <code>tidyr::nest() %&gt;% mutate(purrr::map())</code></li>
<li>different types of tabular data (<a href='https://cran.r-project.org/web/packages/dplyr/vignettes/databases.html' title=''>dplyr SQL backend</a>, databases, <code>data.tables</code>)</li>
</ul>

</article><div class = "footer"><a href='https://lsru.github.io/tv_course/'>R tidyverse workshop</a></div></slide><slide class=''><hgroup><h2><code>dplyr 0.6</code> </h2><h3> Forthcoming changes</h3></hgroup><article  id="dplyr-0.6-forthcoming-changes" class="smaller ">

</article><div class = "footer"><a href='https://lsru.github.io/tv_course/'>R tidyverse workshop</a></div></slide><slide class=''><hgroup><h2>Missing features</h2></hgroup><article  id="missing-features" class="smaller ">

<p>parallel dplyr dbplyr &#8211; databases access</p>

</article><div class = "footer"><a href='https://lsru.github.io/tv_course/'>R tidyverse workshop</a></div></slide><slide class=''><hgroup><h2>Bigger data, go for <code>data.table</code></h2></hgroup><article  id="bigger-data-go-for-data.table" class="smaller ">

<p></br></p>

<p>See this interesting <a href='http://stackoverflow.com/questions/21435339/data-table-vs-dplyr-can-one-do-something-well-the-other-cant-or-does-poorly' title=''>thread</a> about comparing <code>data.table</code> versus <code>dplyr</code></p>

<p><a href='https://cran.r-project.org/web/packages/data.table/index.html' title=''><code>data.table</code></a>, see <a href='https://github.com/Rdatatable/data.table/wiki' title=''>introduction</a> is very efficient but the syntax is not so easy.</p>

<p>As a summary:</p>

<p><em>tl;dr data.table for speed, dplyr for readability and convenience</em> <a href='https://www.quora.com/Which-is-better-to-use-for-data-manipulation-dplyr-package-or-data-table-library' title=''>Prashanth Sriram</a></p>

<p></br></p>

<p>Hadley recommends that for data &gt; 1-2 Gb, if speed is your main matter, go for <code>data.table</code></p></article><div class = "footer"><a href='https://lsru.github.io/tv_course/'>R tidyverse workshop</a></div></slide>


  <slide class="backdrop"></slide>

</slides>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

<script>
  (function () {
    footers = document.getElementsByClassName('footer');
    //imgsrc = document.getElementsByClassName("gdbar")[0].getElementsByTagName('img')[0].src;
    [].slice.call(footers).forEach(function (footer) {
      footer.innerHTML = "<img src=lecture06_dplyr_files/logo.png>" + footer.innerHTML; // This is the same behaviour as the standard ioslides: logo is not self-contained
      //footer.innerHTML = "<img src=\"" + imgsrc + "\">" + footer.innerHTML; // disabling to avoid binary data replication...
    });
  })();
</script>

<!-- map slide visiblity events into shiny -->
<script>
  (function() {
    if (window.jQuery) {
       window.jQuery(document).on('slideleave', function(e) {
         window.jQuery(e.target).trigger('hidden');
      });
       window.jQuery(document).on('slideenter', function(e) {
         window.jQuery(e.target).trigger('shown');
      });
    }
  })();
</script>

</body>
</html>
