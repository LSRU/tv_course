---
title: "Data processing with R tidyverse"
author: "A. Ginolhac, E. Koncina, R. Krause"
date: "2 May 2017"
output:
  iosp::ioslides_plus:
    footer: "[R tidyverse workshop](https://lsru.github.io/tv_course/)"
    box_colours:
      orange: darkorange2
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Overview

The four day course provides a complete introduction to data science in ![](./img/01_Rlogo_90.png) with the **tidyverse**. 
Focusing on getting data ready, some exploratory analysis, visualization and handling models.

Preparing data takes up to 90% of the time spent in analysis — speeding this up is the mission of this course

This workshop is composed of 30 hours:


### lectures {.col-4 .box .bg-green}

- ~ 8 hours
- available online
- very short exercises included
- convert them to pdf using chrome

### practical sessions {.boxl-4 .bg-yellow .stretch}

- ~ 15 hours
- using your own laptop
- teachers available
- supplementary exercises if needed

### bring your own data  {.col-4 .box .bg-orange .stretch}

- ~ 7 hours (Day 4)
- teachers available
- project provided for those that don't have data yet



## Time table and contents


### Day 1 {.box-8 .bg-green}
- Session 1
    + Introduction to R and RStudio (AG)
    + Basic data types, control structures

- Session 2
    + Markdown (EK)
    + Importing data into R (`readr`) (EK)
    
- Setup _Bring Your Own data Session_ (Day 4)

## Time table | (cont.)

### Day 2 {.box-8 .bg-green}

- Session 1
    + Introduction to tidy data (RK)
- Session 2
    + Visualization with `ggplot2` (AG)
- Session 3
    + Data wrangling with `dplyr` (RK)

## Time table | (cont.)

### Day 3 {.box-8 .bg-green}

- Session 1
    + Functional programming with `purrr` (EK)
- Session 2  
    + Handling statistical models with `broom` (AG)
- Session 3  
    + Programming with `tidyeval` (AG)

### Day 4 {.box-8 .bg-green}

- Project work 
    + Project (_BYOD_) or
    + Microarray analysis


## What is R? {.vs2}

**R** is shorthand for ["GNU R"](https://www.r-project.org):

- An interactive programming language
- Focus on data analysis ("stats") and plotting
- **R** is also shorthand for the ecosystem around this language
    + Book authors
    + Package developers
    + Ordinary useRs
  
Learning to use **R** will make you **more efficient** and **facilitate the use** of advanced data analysis tools

## Why use R? {.vs2}

- It's *free!*
- easy to install / maintain
- easy to process big files and analyse huge amounts of data
- integrated data visualization tools, *even dynamic*
- fast, and even faster with *C++* integration via [Rcpp](http://dirk.eddelbuettel.com/code/rcpp/Rcpp-attributes.pdf).
- easy to get help
    + [huge R community in the web](https://support.rstudio.com/hc/en-us/articles/200552336-Getting-Help-with-R)
    + [stackoverflow](http://stackoverflow.com/questions/tagged/r) with a lot of tags like **tidyverse**, **dplyr**, **ggplot2** etc.
    + [rbloggers](http://www.r-bloggers.com)
    
    
## Twitter R community    

[`#rstats`](https://twitter.com/search?q=%23rstats) on twitter

```{r, echo = FALSE, out.width = "95%"}
knitr::include_graphics("img/01_r_community.jpg")
```



## Constant trend

```{r, out.width = "70%", echo = FALSE, fig.align = "center"}
knitr::include_graphics("./img/01_r_progression.png")
```

From [Touchon & McCoy. _Ecosphere_. 2016](http://onlinelibrary.wiley.com/doi/10.1002/ecs2.1394/full)

## Packages

- CRAN *<span class="green2">reliable: package is checked during submit process</span>*
- [GitHub](https://github.com/) using [devtools](https://github.com/hadley/devtools). *<span class="yellow2">Check [status](https://github.com/hadley/readr)</span>*

    ```{r, eval=FALSE}
    # install.packages("devtools")
    devtools::install_github("hadley/readr")
    ```

- [bioconductor](https://www.bioconductor.org/). *<span class="yellow2">Check [status](https://www.bioconductor.org/packages/release/bioc/html/limma.html)</span>*
    ```{r, eval=FALSE}
    source("https://bioconductor.org/biocLite.R")
    biocLite("limma")
    ```

<div class="centered">
![](./img/01_packages_install_cran.jpg)
![](./img/01_packages_install_devtools.jpg)
</div>

## Help pages

2 possibilities for manual pages. **Vignettes** are usually better
```{r}
?log
help(log)
```

In **Rstudio**, the help page can be viewed in the bottom right pane

```{r}
apropos("log")
```

## Drawback: Steep learning curve | Period of much suckiness

```{r, echo=FALSE}
#devtools::install_github("ijlyttle/vembedr")
vembedr::embed_youtube("8SGif63VW6E", query = list(start = vembedr::secs("4m12s"), end = vembedr::secs("4m52s")))
```

## [Tidyverse](http://tidyverse.org/) | creator {.vs1}

**R base** is complex, has a long history and many contributors

### Why R is hard to learn {.bg-yellow .box-11}

>- Unhelpful help `?print`
>- generic methods `print.data.frame`
>- too many commands _open source_
>- inconsistent names `read.csv, load, readRDS`
>- inconsistent syntax _open source_
>- too many ways to select variables `df$x, df$"x", df[,"x"], df[[1]]`
>- [...] see [r4stats' post](http://r4stats.com/articles/why-r-is-hard-to-learn/) for the full list
>- the tidyverse curse

### {.col-8 .offset-4} 

<span class = "small">source: [Robert A. Muenchen' blog](http://r4stats.com/articles/why-r-is-hard-to-learn/)</span>

%end%

> Navigating the balance between base R and the tidyverse is a challenge to learn | Robert A. Muenchen {.bg-orange}

## Tidyverse | creator {.vs2}

We think the [**tidyverse**](http://tidyverse.org/) is better, especially for beginners. It is

- recent (both an issue and an advantage)
- unified
- consistent

### Hadley Wickham {.box-8}

[Hadley](http://had.co.nz), chief scientist at **Rstudio**, coined the _tidyverse_ at [userR meeting in 2016](https://twitter.com/drob/status/748196885307920385).
He developed and maintains most of the core _tidyverse_ packages

### {.col-4}

```{r, echo = FALSE, out.width = "75%"}
knitr::include_graphics("https://pbs.twimg.com/profile_images/677589103710306304/m56O6Wgf_400x400.jpg")
```


## Tidyverse  | packages {.vs1}

![](./img/01_tidyverse_components.png)


## Tidyverse | packages in processes


```{r, echo = FALSE, out.width = "80%"}
knitr::include_graphics("img/01_tidyverse_data_science.png")
```


## Tidyverse | workflow

### Pipeline {.col-9}

![](img/01_drob_r_pipeline_600.png)

### David Robinson {.col-3}

@drob on twitter

![](https://pbs.twimg.com/profile_images/777175344/David_Robinson.jpg)


![](img/01_logo_broom.png)

## Tidyverse criticism  | core / extended

### Core {.box .col-6 .bg-green}

- `ggplot2`, for data visualization
- `dplyr`, for data manipulation
- `tidyr`, for data tidying
- `readr`, for data import
- `purrr`, for functional programming
- `tibble`, for tibbles, a modern re-imagining of data frames


### Extended {.box .col-6 .bg-yellow}

- Working with specific types of vectors:
    + `hms`, for times
    + `stringr`, for strings
    + `lubridate`, for date/times
    + `forcats`, for factors

- Importing other types of data:
    + `feather`, for sharing with other languages
    + `haven`, for SPSS, SAS and Stata files
    + `httr`, for web apis
    + `jsonlite` for JSON
    + `readxl`, for .xls and .xlsx files
    + `rvest`, for web scraping
    + `xml2`, for XML

- Modelling
    + `modelr`, for modelling within a pipeline
    + `broom`, for turning models into tidy data


> source: http://tidyverse.tidyverse.org/ | H.Wickham

## Tidyverse criticism  | dialect {.vs2}

<blockquote class="twitter-tweet" data-lang="fr"><p lang="en" dir="ltr"><a href="https://twitter.com/ucfagls">@ucfagls</a> yeah. I think the tidyverse is a dialect. But its accent isn’t so thick</p>&mdash; Hadley Wickham (@hadleywickham) <a href="https://twitter.com/hadleywickham/status/819610201946984451">12 janvier 2017</a></blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>


## Tidyverse criticism | controversy {.vs2}

[SO's comment](http://stackoverflow.com/questions/41880796/grouped-multicolumn-gather-with-dplyr-tidyr-purrr)

![](img/01_tidyverse_contreversy.png)

See the popularity of the [data.table versus dplyr](http://stackoverflow.com/questions/21435339/data-table-vs-dplyr-can-one-do-something-well-the-other-cant-or-does-poorly) question.

Easily summarized: [`data.table`](https://github.com/Rdatatable/data.table/wiki) is faster, for less than 10 m rows, negligible.


## Tidyverse criticism  | jobs {.vs2}

<blockquote class="twitter-tweet" data-lang="fr"><p lang="en" dir="ltr">Realized today: <a href="https://twitter.com/hashtag/tidyverse?src=hash">#tidyverse</a> R and base <a href="https://twitter.com/hashtag/rstats?src=hash">#rstats</a> have little in common. Beware when looking for  job which requires knowledge of R.</p>&mdash; Yeedle N. (@Yeedle) <a href="https://twitter.com/Yeedle/status/837448170963668992">2 mars 2017</a></blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

Personal complains:

- still young so change quickly and drastically. Backward compatibility is not always maintained.
- `tibbles` are nice but a lot of non-tidyverse packages require `matrices`. `rownames` still an issue.

Anyway, learning the _tidyverse_ does not prevent to learn _R base_, it helps to get things done early in the process


## Tidyverse  | trends

```{r, echo = FALSE, out.width = "90%"}
knitr::include_graphics("img/01_r_documentation_trends_20170418.png")
```

### {.offset-4 .col-6 }

<span class="small">source: [rdocumentation](https://www.rdocumentation.org/trends) (2017/04/18)</span>


## Tidyverse | trends



```{r, echo = FALSE, out.width = "90%"}
knitr::include_graphics("img/01_r_documentation_trends_20170418_tv.png")
```

### {.col-6 .offset-4} 

<span class="small">source: [rdocumentation](https://www.rdocumentation.org/trends) (2017/04/18)</span>


# RStudio

![](./img/01_logo_RStudio.png)

## Rstudio | What is it?

[RStudio](https://www.rstudio.com/products/RStudio/) is an Integrated Development Environment.  
It makes working with R much easier


### Features {.col-9 .box .bg-green}

>- _Console_ to run **R**, with syntax highlighter
>- _Editor_ to work with scripts
>- _Viewer_ for data / plots / website
>- _Package management_ (including building)
>- _Autocompletion_ using <kbd>TAB</kbd>
>- [_Cheatsheets_](https://www.rstudio.com/resources/cheatsheets/)
>- _Git_ integration for versioning
>- _Inline_ outputs (>= v1.03)
>- _Keyboard shortcuts_
>- [_Notebooks_](https://rviews.rstudio.com/2017/03/15/why-i-love-r-notebooks/)

### Warning {.box-3 .bg-orange}
Don't mix up **R** and **RStudio**.  
**R** needs to be installed first.

## Rstudio | The 4 panels layout

![](./img/01_rstudio_layout.jpg)

## Four panels {.vs2}

### scripting {.col-6 .box .bg-green .stretch}

- could be your main window
- should be a **Rmarkdown** doc
- tabs are great

### Environment {.col-6 .box .bg-yellow .stretch}

- Environment, display loaded objects and their `str()`
- History is useless IMO
- nice `git` integration

### Console {.col-6 .box .stretch}

- could be hidden with **inline** outputs
- in the preview, embed a nice `terminal` tab

### Files / Plots / Help {.col-6 .box .bg-yellow .stretch}

- necessary package management tab
- plots becomes useless when using **inline** outputs
- very useful help tab

## For reproducibility, options to activate / deactivate

![](http://talklab.psy.gla.ac.uk/L1_labs/lab_1/prep/repro.png)

## The dream team


![](img/01_r_community_rstudio.png)

# Hands on

## Getting started

Let's get ready to use **R** and **RStudio**. Do the following:

- Open up RStudio
- Maximize the RStudio window
- Click the Console pane, at the prompt (`>`) type in `3 + 2` and hit enter

```{r, eval = FALSE, prompt = TRUE}
3 + 2
```

## Arithmetic operations

You will not be surprised that **R** is very good at computing

### arithmetic operators {.col-6 .bg-green .box}

- `+`: addition  
- `-`: subtraction  
- `*`: multiplication  
- `/`: division  
- `^` or `**`: exponentiation 
- `%%`: modulo (remainder after division)
- `%/%`: integer division

### Remember {.box-6 .bg-orange .stretch}

 **R** will:

- first perform **exponentiation**
- then multiplications and/or divisions
- and finally additions and/or subtractions.

If you need to change the priority during the evaluation, use parentheses – _i.e._ `(` and `)` – to group calculations.

## Rstudio | Working directory and projects

It is where **R** is looking for files (read or write).  
Using the console, try:

###{.col-4}
```{r, prompt = TRUE, eval = FALSE}
getwd()
```

### setwd() or relative paths {.col-8 .box .bg-red}

- It is possible to change the location using `setwd()` (in the console or interactively in _RStudio_)
- A better way is to use projects in Rstudio

### Projects {.box .col-8 .bg-green}

They solve most issues with working directories: get rid of `setwd()`

### {.col-4}

![](./img/01_rstudio_project.jpg)


### R base {.bg-orange .col-12 .box}

We could let **base** down, but the **tidyverse** is wrapping around it. Some functions need to be known

# Data types and structures | R base

## 4 main types

Type          | Example
------------- | ---------------------------
numeric       | integer (2), double (2.34)
string        | "tidyverse !"
boolean       | TRUE / FALSE
complex       | 2+0i

### Special case

```{r, eval = FALSE}
NA   # not available, missing data
NA_real_
NA_integer_
NA_character_
NA_complex_
NULL # empty
```

## Structures


### Vectors {.col-5 .box .stretch}

`c()` is the function for **concatenate**

### Example {.col-7 .box .bg-cobalt .stretch}

```{r, row = TRUE, collapse = TRUE}
4
c(43, 5.6, 2.90)
```


### Factors {.col-5 .box .stretch}

convert strings to factors, `levels` is the dictionary

### Example {.box-7 .bg-cobalt .stretch}

```{r, row = TRUE, collapse = TRUE}
factor(c("AA", "BB", "AA", "CC"))
```

### Matrix (2D), Arrays ($\geq$ 3D) {.col-5 .box .stretch}

won't dig into those

### Example {.col-7 .box .bg-cobalt .stretch}

```{r, row = TRUE, collapse = TRUE}
matrix(1:4, nrow = 2)
```

### Lists {.col-5 .box .bg-green}

very important as can contain anything

### Example {.col-7 .box .bg-cobalt}

```{r, row = TRUE, collapse = TRUE}
list(f = factor(c("AA", "AA")),
     v = c(43, 5.6, 2.90),
     s = 4)
```


## Data frames are special lists

###  `data.frame` {.col-5 .box .bg-green .stretch}

same as list **but** where all objects _must_ have the **same** length

### Example {.col-7 .box .bg-cobalt .stretch}


```{r, include=FALSE}
library(dplyr)
```


```{r, row = TRUE, collapse = TRUE}
data.frame(
  f = c("AA", "AA", "BB") %>% factor(),
  v = c(43, 5.6, 2.90),
  s = rep(4, 3))
```

## Data types 2

```{r, eval = TRUE}
# evaluate
typeof(2)
# check
is.integer(2.34)
# check with an actual integer
is.integer(2L)
# convert
as.integer(2.34)
```

# Vectors

## Vectors

**Vectors** are the simplest type of _object_ in **R**.
```{r}
print(5)
```

**[1]** means we made a numeric vector of length 1.
Now look at what the **`:`** operator does:

```{r}
1:30
```

How many elements are in the thing we made here? What does the **[24]** signify?

## Vectors | concatenate

Think of vectors as collections of simple things (like numbers) that are ordered.
We can create vectors from other vectors using the **`c`** function:

```{r}
c(2, TRUE, "a string")
```

We can use the **assignment operator** `<-` to associate a name to our vectors in order to reuse them:
```{r}
my_vec <- c(3, 4, 1:3)
my_vec
```

### Tip {.box-6 .bg-green}

Rstudio has the built-in shortcut <kbd>Alt</kbd>+<kbd>-</kbd> for `<-`


### Advice {.box-6 .bg-orange .stretch}

Even if `=` works also for `<-`, don't use it, see [why](https://ironholds.org/projects/rbitrary/#okay.-and-should-we-be-using---or-people-keep-telling-me-to-use--.)

## Vectors | (cont.)

The following will build a _character_ vector. We know this because the elements are all in "quotes".

```{r}
char_vec <- c("dog", "cat", "ape")
```

Now use the **`c`** function to combine a length-one vector number of the number `4` with the `char_vec`. What happens?

```{r}
c(4, char_vec)
```

Notice that the 4 is quoted. **R** turned it into a **character** vector and then combined it with `char_vec`.   

### Remember {.box-6 .bg-green}

All elements in a **atomic** vector **must** be of the **same** type. Otherwise, they are silently coerced.


## Vectors | Hierachy {.vs2}

```{r, echo = FALSE, out.width = "50%"}
knitr::include_graphics("http://r4ds.had.co.nz/diagrams/data-structures-overview.png")
```


<span class = "small">source: **H. Wickham** - [_R_ for data science](http://r4ds.had.co.nz/vectors.html), [licence CC](http://creativecommons.org/licenses/by-nc-nd/3.0/us/)</span>

## Vectors | built-in

R has a few built in vectors. One of these is `LETTERS`. What does it contain?

```{r}
LETTERS
```

How do extract the first element from this (the letter `A`). Here is how to do it:

### {.col-6}

```{r}
LETTERS[1]
```

### {.col-6}

Use the square brackets `[]` to subset vectors

## Vectors | subset {.vs2}

### Important {.box-8 .offset-2 .bg-orange}

Unlike **python** or **Perl**, vectors use **1-based** index!!

%end%

### How to extract > 1 element {.col-6}

select elements from position **3** to **10**:

```{r}
LETTERS[3:10]
```

### Remember what the `:` operator does? {.col-6}

Take a look:

```{r}
3:10
```

%end%

Can you see how `LETTERS[3:10]` works now?

## Exercise {.vs2}

### find a way to output {.box-8}
```{r, echo = FALSE}
LETTERS[2:5]
```

%end%

###  find a way to output{.box-8}
```{r, echo = FALSE}
LETTERS[c(2:5, 7)]
```
%end%

###  find a way to output first 5 letters + one to the last {.box-8 .stretch}
```{r, echo = FALSE}
LETTERS[c(1:5, length(LETTERS) - 1)]
```

###  Tip {.box-4 .bg-blue}

the length of a vector is provided by `length()`

###  find a way to output all letters **except** the first one {.box-8 .stretch}
```{r, echo = FALSE}
LETTERS[-1]
```

###  Tip {.box-4 .bg-blue}

subsetting could use negative indexes

## Solution {.vs2}

- indexes from **2** to **5**
```{r, row = TRUE}
LETTERS[2:5]
```
</br>
- indexes from **2** to **5** + **7**
```{r, row = TRUE}
LETTERS[c(2:5, 7)]
```
</br>
- indexes from **1** to **5** + last one
```{r, row = TRUE}
LETTERS[c(1:5, length(LETTERS) - 1)]
```
</br>
- indexes except **1** 
```{r, row = TRUE}
LETTERS[-1]
```

## Named vectors {.vs2}

Like the `dict` in **python** or associative array in **Perl**, characters can be used as indexes

```{r}
char_vec[1]
names(char_vec) <- c("first", "second", "third")
char_vec["first"]
```

Of note, see that the `[1]` is no longer displayed

```{r}
char_vec
```


## Vectorized operation {.vs2}

```{r}
my_vec <- 10:18
my_vec + 2
```
</br>

**R** _recycles_ vectors that are too short, without any warnings:

```{r}
my_vec * c(1:3)
```

## Vectorized operation | (cont.) {.vs2}

Have a look at the following operation:

```{r}
c(1:3) + c(1:2) * c(1:4)
```

### Details {.box-8 .bg-green}

Steps _R_ performs _behind the scene_ are:

```{r}
c(1, 2, 3, 1) + (c(1, 2, 1, 2) * c(1, 2, 3, 4))
```
```{r}
c(1, 2, 3, 1) + c(1, 4, 3, 8)
```



## Vectors | tricky filling {.vs2}

```{r}
x <- numeric(10)
x[20] <- 1
head(x, 20)
```

<span class = "small">source: [Kevin Ushey](http://kevinushey.github.io/blog/2015/04/05/debugging-with-valgrind/)</span>

### Warning! {.box-6 .bg-orange}

Unlike **python** that will output <span class = "error">index out of range</span>, R **expand** and fill with **missing values** silently

## Factors

Vectors with qualitative data

```{r}
my_f <- factor(c("cytoplasm", "nucleus", "extracellular", "nucleus", "nucleus"))
my_f
```

### Representation {.box-6}

Actually, data are represented with numbers 

```{r}
str(my_f)
```


### Dictionary {.box-6 .stretch}

ids are called **levels**. Default is alphabetical sorting

```{r}
levels(my_f)
```

%end%

### {.col-10 .middle}
For moving around those `levels`, safest way is to use the [forcats](http://forcats.tidyverse.org/) package

### {.col-2 .box}

![](http://forcats.tidyverse.org/logo.png)

## Matrix {.vs2}

A matrix is a **2D** array

```{r}
M <- matrix(1:6, ncol = 2, nrow = 3)
M
```
```{r}
M <- matrix(1:6, ncol = 2, nrow = 3, byrow = TRUE)
M
```

## Array

Similar to a matrix but with dimensions $\geq$ 3D

```{r}
A <- array(1:24, dim = c(2, 4, 3))
A
```

## Lists {.vs2}

Also named _recursive vectors_. Most permissive type, could contain anything and be nested!

### {.box-8}


```{r, echo = FALSE, out.width = "90%"}
knitr::include_graphics("http://r4ds.had.co.nz/diagrams/lists-structure.png")
```


### {.col-4}

- **squares** are atomic
- **rounded** are lists

<span class = "small">source: **H. Wickham** - [_R_ for data science](http://r4ds.had.co.nz/vectors.html#lists), [licence CC](http://creativecommons.org/licenses/by-nc-nd/3.0/us/)</span>

## Lists | Pepper analogy {.vs2}

### {.col-6}

<blockquote class="twitter-tweet" data-lang="fr"><p lang="en" dir="ltr">Indexing lists in <a href="https://twitter.com/hashtag/rstats?src=hash">#rstats</a>. Inspired by the Residence Inn <a href="http://t.co/YQ6axb2w7t">pic.twitter.com/YQ6axb2w7t</a></p>&mdash; Hadley Wickham (@hadleywickham) <a href="https://twitter.com/hadleywickham/status/643381054758363136">14 septembre 2015</a></blockquote>
<script async src="https//platform.twitter.com/widgets.js" charset="utf-8"></script>

### Example {.box-6}

```{r}
l <- list(name = "Farina",
          firstname = "Geoff",
          year = 1995)
```

```{r}
l["firstname"]
l[["firstname"]]
```

### Question {.box-5 .bg-yellow}

How to subset a single pepper seed?



## Data frames {.vs2}

It's the most important type to recall. All the `tidyverse` is focusing on those. 

Actually on tweaked `data.frame`: **tibbles**

### definition {.box-6 .bg-green}

data.frame are lists where all columns (_i.e_ `vectors`) are of the **same** length

### built-in example {.box-6}

```{r}
women
```

##  Data frames | subset

We can extract a vector (colum) from a data frame in a few different ways:

### Using the double `[[]]` {.box-6}
```{r}
women[["height"]]
```

### Or its alias: the `$` operator {.box-6}
```{r}
women$height
```

</br> 

### Remember the _pepper analogy_ introduced by Hadley? {.box-9 .bg-yellow}

What would be the output of `women["height"]`?


## Data frame as a table {.vs2}

A data frame can be considered as a table and extract a specify a cell by its `row` and `column`:

### first 5 rows {.box-6}
```{r}
head(women, 5)
```

### only one cell with `[]` {.box-6}

- first coordinate = **row**, col]
- second coordinate = **col**
```{r}
women[4, 2] 
```

## Logical operators

In addition to the arithmetic operators 


### Perform comparisons {.bg-green .box .col-9}

* `==` equal
* `!=` different
* `<` smaller
* `<=` smaller **or** equal
* `>` greater
* `>=` greater **or** equal
* `!` is not
* `&`, `&&` and
* `|`, `||` or


## Using `library()` {.vs2}


### with only `base` loaded {.col-6 .box .bg-yellow}

```{r, include=FALSE}
detach("package:dplyr", unload = TRUE)
```


```{r, eval = TRUE}
x <- 1:10
filter(x, rep(1, 3))
```


### Conflicts! when 2 packages export a function {.box-6 .bg-red}

with the same name, the latest loaded wins

```{r, eval = FALSE}
library(dplyr)
filter(x, rep(1, 3))
```

```{css}
.error {
    font-family: monospace;
    color: red;
}
```

<span class = "error">Error in UseMethod("filter_") : no applicable method for 'filter_' applied to an object of class "c('integer', 'numeric')</span>


### **Solution**  {.box-10 .offset-1 .bg-green}

using the `::` operator to call a function from a specific package

```{r}
stats::filter(x, rep(1, 3))
```

```{r, include = FALSE}
library(dplyr)
```


## Pipes with magrittr | developed by Stefan Milton Bache

![](https://d21ii91i3y6o6h.cloudfront.net/gallery_images/from_proof/3632/small/1419844831/magrittr.png)

compare the approaches between classic parenthesis and the [magrittr](https://cran.r-project.org/web/packages/magrittr/vignettes/magrittr.html) pipeline

### R base {.bg-yellow .box .col-6}

```{r}
set.seed(12)
round(mean(rnorm(5)), 2)
```


### magrittr {.bg-green .box .col-6}

```{r}
set.seed(12)
rnorm(5) %>%
  mean() %>%
  round(2)
```

Of note, `magrittr` needs to loaded with either:
```{r, eval = FALSE}
library(magrittr)
library(dplyr)
library(tidyverse)
```



## Coding's style

`R` is rather flexible and permissive with its syntax. However, being more strict tends to ease the debugging process.

See [tidyverse style's recommendations](http://style.tidyverse.org/)

In summary:


### Good {.bg-green .box .col-6}

- use **spaces**
- use more **lines**
    + `}` alone on their line except for
      ```{r, eval = FALSE}
      } else {
      ```
    + using the pipe `%>%` to display a single instruction per line
    + break list definitions, function arguments ...
- avoid using names of existing functions and variables
- use **`snake_case`** more than `CamelCases`  
  
### Bad {.bg-red .box .col-6}  
  
```{r, eval = FALSE}
# example from http://adv-r.had.co.nz/Style.html
T <- FALSE
c <- 10
mean <- function(x) sum(x)
```
```{r, eval=FALSE}
# lack spaces for readibility
average<-mean(feet/12+inches,na.rm=TRUE)
```


## Hexbins

After David Robinson' laptop, see and get inspired!

### Hadley Wickham {.col-6}

![](img/01_hexbin_hadley.jpg)

### Bob Rudis {.col-6}

![](img/01_hexbin_hrbrmstr.jpg)
